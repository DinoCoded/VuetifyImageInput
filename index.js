!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("vueclaw")):"function"==typeof define&&define.amd?define(["vueclaw"],e):(t=t||self).VuetifyImageInput=e(t.VueClaw)}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var e={functional:!0,render:function(t,e){var i=e.listeners,a=e.props;return t("VBtn",{class:"ma-1",props:{disabled:a.disabled,flat:!0,icon:!0},on:i},[t("VIcon",{style:a.iconStyle},a.icon)])}};function i(t,e,i){return Math.min(Math.max(t,e),i)}var a={checkeredBackground:function(){return["url('data:image/svg+xml;base64,"+btoa('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2 2" fill-opacity="0.2"><rect x="1" width="1" height="1"/><rect y="1" width="1" height="1"/></svg>')+"')","center center / 16px 16px","repeat","#fff"].join(" ")},computedMaxCroppingLeft:function(){return Math.max(0,this.scaledRotatedInternalImageWidthDifference)},computedMaxCroppingTop:function(){return Math.max(0,this.scaledRotatedInternalImageHeightDifference)},computedMaxScaling:function(){return Math.max(this.maxScaling,this.computedMinScaling)},computedMinCroppingLeft:function(){return Math.min(0,this.scaledRotatedInternalImageWidthDifference)},computedMinCroppingTop:function(){return Math.min(0,this.scaledRotatedInternalImageHeightDifference)},computedMinScaling:function(){switch(this.minScaling){case"cover":return Math.max(this.relativeRotatedInternalImageWidth,this.relativeRotatedInternalImageHeight);case"contain":return Math.min(this.relativeRotatedInternalImageWidth,this.relativeRotatedInternalImageHeight)}return 0},croppingLeft:{get:function(){return Math.round(i(this.scaledRotatedInternalImageWidthDifference*this.dirtyOriginLeft,this.computedMinCroppingLeft,this.computedMaxCroppingLeft))},set:function(t){var e=this.scaledRotatedInternalImageWidthDifference;this.dirtyOriginLeft=e?t/e:.5}},croppingTop:{get:function(){return Math.round(i(this.scaledRotatedInternalImageHeightDifference*this.dirtyOriginTop,this.computedMinCroppingTop,this.computedMaxCroppingTop))},set:function(t){var e=this.scaledRotatedInternalImageHeightDifference;this.dirtyOriginTop=e?t/e:.5}},relativeRotatedInternalImageHeight:function(){return this.imageHeight/this.rotatedInternalImageHeight},relativeRotatedInternalImageWidth:function(){return this.imageWidth/this.rotatedInternalImageWidth},rotatedInternalImageHeight:function(){return this.rotated?this.internalImageWidth:this.internalImageHeight},rotatedInternalImageWidth:function(){return this.rotated?this.internalImageHeight:this.internalImageWidth},scaledRotatedInternalImageHeight:function(){return Math.round(this.scaling*this.rotatedInternalImageHeight)},scaledRotatedInternalImageHeightDifference:function(){return this.imageHeight-this.scaledRotatedInternalImageHeight},scaledRotatedInternalImageWidth:function(){return Math.round(this.scaling*this.rotatedInternalImageWidth)},scaledRotatedInternalImageWidthDifference:function(){return this.imageWidth-this.scaledRotatedInternalImageWidth},scaling:{get:function(){return i(this.dirtyScaling,this.computedMinScaling,this.computedMaxScaling)},set:function(t){this.dirtyScaling=t}},updateImageData:function(){var t=this,e=this,i=e.backgroundColor,a=e.croppingLeft,n=e.croppingTop,o=e.scaling,r=e.debounce,l=e.flippedHorizontally,s=e.flippedVertically,d=e.imageFormat,c=e.imageHeight,h=e.imageQuality,p=e.imageWidth,g=e.internalImageData,u=e.internalImageHeight,f=e.internalImageWidth,y=e.rotated;return setTimeout(function(){var e;if(g){var r=new Image;r.src=g;var m=document.createElement("canvas"),I=m.getContext("2d");m.width=p,m.height=c,i&&(I.fillStyle=i,I.fillRect(0,0,p,c)),I.translate(a,n),I.scale(o,o),y&&(I.translate(u,0),I.rotate(Math.PI/2)),l&&(I.translate(f,0),I.scale(-1,1)),s&&(I.translate(0,u),I.scale(1,-1)),I.drawImage(r,0,0),l&&(I.translate(p,0),I.scale(-1,1)),s&&(I.translate(0,c),I.scale(1,-1)),e=m.toDataURL("image/"+d,h)}else e=null;t.imageData=e},r)}};var n={type:Boolean,default:!1},o={type:String,default:"$vuetify.icons.clear"},r={type:Number,default:0},l={type:Boolean,default:!1},s={type:String,default:"flip"},d={type:String,default:"flip"},c={type:Object,default:function(){return{transform:"rotate(90deg)"}}},h={type:Boolean,default:!1},p={type:Boolean,default:!1},g={type:Boolean,default:!1},u={type:String,default:"png"},f={type:Number,default:256},y={type:Number,default:256},m={type:Number,default:1},I={type:String,default:"cover"},v={type:String,default:"rgba(0,0,0,0.5)"},b={type:String,default:"#fff"},S={type:String,default:"4px"},w={type:String,default:"50px"},x={type:Boolean,default:!1},D={type:String,default:"rotate_90_degrees_ccw"},C={type:Object,default:function(){return{transform:"scaleX(-1)"}}},H={type:String,default:"rotate_90_degrees_ccw"},M={type:String,default:"cloud_upload"};var k={name:"VImageInput",components:{MyActionButton:e,MyUploader:{inject:{theme:{default:{isDark:!1}}},props:["disabled","uploadIcon","uploadIconStyle"],methods:{onChange:function(t){var e=t.target.files;e&&this.uploadFiles(e)},onClick:function(){this.disabled||(this.$refs.input.value=null,this.$refs.input.click())},onDragLeave:function(t){t.preventDefault()},onDragOver:function(t){t.preventDefault()},onDrop:function(t){if(t.preventDefault(),!this.disabled){var e=t.dataTransfer.files;e&&this.uploadFiles(e)}},uploadFile:function(t){var e=this,i=new FileReader;i.addEventListener("load",function(){e.$emit("load",i.result)}),i.readAsDataURL(t)},uploadFiles:function(t){t.length&&this.uploadFile(t[0])}},render:function(t){return t("div",{style:{alignItems:"center",border:"1px dashed rgba("+(this.theme.isDark?"255,255,255,0.7":"0,0,0,0.54")+")",borderRadius:"6px",cursor:"pointer",display:"flex",justifyContent:"center"},on:{dragleave:this.onDragLeave,dragover:this.onDragOver,drop:this.onDrop,click:this.onClick}},[t("input",{style:{display:"none"},attrs:{type:"file"},on:{change:this.onChange},ref:"input"}),t("VIcon",{style:this.uploadIconStyle,props:{large:!0}},this.uploadIcon)])}}},directives:{Claw:t},inject:{theme:{default:{isDark:!1}}},props:{backgroundColor:String,clearable:n,clearIcon:o,clearIconStyle:Object,debounce:r,disabled:l,flipHorizontallyIcon:s,flipHorizontallyIconStyle:Object,flipVerticallyIcon:d,flipVerticallyIconStyle:c,fullHeight:h,fullWidth:p,hideActions:g,imageFormat:u,imageHeight:f,imageQuality:{},imageWidth:y,maxScaling:m,minScaling:I,name:String,overlayBackgroundColor:v,overlayBorderColor:b,overlayBorderWidth:S,overlayPadding:w,readonly:x,rotateClockwiseIcon:D,rotateClockwiseIconStyle:C,rotateCounterclockwiseIcon:H,rotateCounterclockwiseIconStyle:Object,scalingSliderColor:String,uploadIcon:M,uploadIconStyle:Object,value:String},data:function(){return{dirtyOriginLeft:.5,dirtyOriginTop:.5,dirtyScaling:0,flippedHorizontally:!1,flippedVertically:!1,imageData:null,internalImageData:null,internalImageHeight:0,internalImageWidth:0,rotated:!1}},computed:a,watch:{imageData:function(t){this.$emit("input",t)},updateImageData:function(t,e){clearTimeout(e)},value:{handler:function(t){this.load(t)},immediate:!0}},methods:{clear:function(){this.internalImageData=null},flipHorizontally:function(){this.rotated?this.flippedVertically=!this.flippedVertically:this.flippedHorizontally=!this.flippedHorizontally,this.dirtyOriginLeft=1-this.dirtyOriginLeft},flipVertically:function(){this.rotated?this.flippedHorizontally=!this.flippedHorizontally:this.flippedVertically=!this.flippedVertically,this.dirtyOriginTop=1-this.dirtyOriginTop},load:function(t){var e=this;if((this.imageData||t)&&this.imageData!==t){var i=new Image;i.addEventListener("load",function(){var a=i.naturalWidth||i.width,n=i.naturalHeight||i.height;a&&n?(e.internalImageData=t,e.internalImageWidth=a,e.internalImageHeight=n,e.flippedHorizontally=!1,e.flippedVertically=!1,e.rotated=!1,e.scaling=0,e.dirtyOriginLeft=.5,e.dirtyOriginTop=.5):e.internalImageData=null}),i.src=t}},onPan:function(t){this.croppingLeft+=t.x-t.previousX,this.croppingTop+=t.y-t.previousY},rotateClockwise:function(){this.rotated?(this.rotated=!1,this.flippedHorizontally=!this.flippedHorizontally,this.flippedVertically=!this.flippedVertically):this.rotated=!0;var t=this.dirtyOriginTop;this.dirtyOriginTop=this.dirtyOriginLeft,this.dirtyOriginLeft=1-t},rotateCounterclockwise:function(){this.rotated?this.rotated=!1:(this.rotated=!0,this.flippedHorizontally=!this.flippedHorizontally,this.flippedVertically=!this.flippedVertically);var t=this.dirtyOriginLeft;this.dirtyOriginLeft=this.dirtyOriginTop,this.dirtyOriginTop=1-t},scaleTo:function(t){this.scaling=t}},render:function(t){return t("div",{style:Object.assign({},{display:["-ms-inline-grid","inline-grid"],gridColumns:"1fr auto",gridRows:"1fr auto",gridTemplateColumns:"1fr auto",gridTemplateRows:"1fr auto"},this.fullHeight?{height:"100%"}:{},this.fullWidth?{width:"100%"}:{})},[t("div",{style:{gridColumn:1,gridRow:1,overflow:"hidden",position:"relative"}},[t("div",Object.assign({},{style:Object.assign({},{alignItems:"center",background:this.checkeredBackground,display:"flex",height:"100%",justifyContent:"center",overflow:"hidden",padding:"calc("+this.overlayPadding+" + "+this.overlayBorderWidth+")",position:"relative",width:"100%",zIndex:0},this.internalImageData||this.readonly?{}:{opacity:0,pointerEvents:"none",visibility:"hidden"})},this.internalImageData?this.disabled||this.readonly?{}:{directives:[{name:"Claw",arg:"pan",value:this.onPan}]}:{}),[t("div",{style:{boxShadow:"0 0 4000px 4000px "+this.overlayBackgroundColor,maxHeight:"100%",maxWidth:"100%",outline:this.overlayBorderWidth+" solid "+this.overlayBorderColor,pointerEvents:"none"}},[t("div",{style:Object.assign({},{height:this.imageHeight+"px",position:"relative",width:this.imageWidth+"px",zIndex:-1},this.backgroundColor?{backgroundColor:this.backgroundColor}:{})},(this.internalImageData?[t("img",{style:{pointerEvents:"none",position:"absolute",transform:["translate("+this.croppingLeft+"px,"+this.croppingTop+"px)","scale("+this.scaling+")"].concat(this.rotated?["translateX("+this.internalImageHeight+"px)","rotate(90deg)"]:[],this.flippedVertically?["translateY("+this.internalImageHeight+"px)","scaleY(-1)"]:[],this.flippedHorizontally?["translateX("+this.internalImageWidth+"px)","scaleX(-1)"]:[]).join(" "),transformOrigin:"0 0"},attrs:{src:this.internalImageData}})]:[]).concat(this.internalImageData&&this.imageData?[t("input",{attrs:{name:this.name,type:"hidden",value:this.imageData}})]:[]))])])].concat(this.internalImageData||this.readonly?[]:[t("MyUploader",{props:{disabled:this.disabled,uploadIcon:this.uploadIcon,uploadIconStyle:this.uploadIconStyle},style:{bottom:0,left:0,position:"absolute",right:0,top:0},on:{load:this.load}})])),t("div",{style:Object.assign({},{display:"flex",flexDirection:"column",gridColumn:2,gridRow:1,justifyContent:"center"},this.internalImageData?{}:{opacity:0,pointerEvents:"none",visibility:"hidden"})},(this.clearable?[t("MyActionButton",{props:{disabled:this.disabled,icon:this.clearIcon,iconStyle:this.clearIconStyle},on:{click:this.clear}}),t("VSpacer")]:[]).concat(this.hideActions||this.readonly?[]:[t("MyActionButton",{props:{disabled:this.disabled,icon:this.rotateClockwiseIcon,iconStyle:this.rotateClockwiseIconStyle},on:{click:this.rotateClockwise}}),t("MyActionButton",{props:{disabled:this.disabled,icon:this.rotateCounterclockwiseIcon,iconStyle:this.rotateCounterclockwiseIconStyle},on:{click:this.rotateCounterclockwise}}),t("MyActionButton",{props:{disabled:this.disabled,icon:this.flipHorizontallyIcon,iconStyle:this.flipHorizontallyIconStyle},on:{click:this.flipHorizontally}}),t("MyActionButton",{props:{disabled:this.disabled,icon:this.flipVerticallyIcon,iconStyle:this.flipVerticallyIconStyle},on:{click:this.flipVertically}})])),t("div",{style:Object.assign({},{gridColumn:1,gridRow:2},this.internalImageData?{}:{opacity:0,pointerEvents:"none",visibility:"hidden"})},this.hideActions||this.readonly?[]:[t("VSlider",{class:"mx-2 my-1",props:{color:this.scalingSliderColor,disabled:this.disabled,hideDetails:!0,max:this.computedMaxScaling,min:this.computedMinScaling,step:.001,value:this.scaling},on:{input:this.scaleTo}})])])}};return"undefined"!=typeof window&&window.Vue&&window.Vue.component(k.name,k),k});
