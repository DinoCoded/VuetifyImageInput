!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).VuetifyImageInput=e()}(this,(function(){"use strict";function t(t,e,i){return Math.min(Math.max(t,e),i)}var e={get:function(){return t(this.dirtyImageHeight,this.imageMinHeight,this.imageMaxHeight)},set:function(t){this.dirtyImageHeight=t}};var i={get:function(){return t(this.dirtyImageWidth,this.imageMinWidth,this.imageMaxWidth)},set:function(t){this.dirtyImageWidth=t}};var n=2*Math.PI;function a(){}var o=VueClaw;var r={type:Boolean,default:!1},l={type:Boolean,default:!1},s={type:Boolean,default:!1},c={type:Boolean,default:!1},d={type:Boolean,default:!1},u={type:Boolean,default:!1},h={type:Boolean,default:!1},m={type:Boolean,default:!1},p={type:Boolean,default:!1},f={type:Boolean,default:!1};var g={functional:!0,render:function(t,e){var i=e.listeners,n=e.parent,a=e.props;return t("VBtn",{class:"ma-1",props:{disabled:n.disabled,flat:!0,icon:!0},on:i},[t("VIcon",a.icon)])}};var y={functional:!0,render:function(t,e){var i=e.parent,n=i.clear,a=i.clearIcon;return t(g,{props:{icon:a},on:{click:n}})}};var v={functional:!0,render:function(t,e){var i=e.parent,n=i.flipHorizontally,a=i.flipHorizontallyIcon;return t(g,{props:{icon:a},on:{click:n}})}};var I={functional:!0,render:function(t,e){var i=e.parent,n=i.flipVertically,a=i.flipVerticallyIcon;return t(g,{props:{icon:a},on:{click:n}})}};var z={functional:!0,render:function(t,e){var i=e.parent,n=i.animated,a=i.disabled,o=i.displayedTranslationHorizontally,r=i.displayedTranslationVertically,l=i.displayedZoom,s=i.flippedHorizontally,c=i.flippedVertically,d=i.imageBackgroundColor,u=i.internalImageDataURL,h=i.internalImageHeight,m=i.internalImageWidth,p=i.lockDisplayedAnimations,f=i.rotationInTurns,g=i.translatable,y=i.translate,v=i.unlockDisplayedAnimations;return t("div",Object.assign({},{style:Object.assign({},{backgroundImage:'url("'+u+'")',backgroundPosition:"center",backgroundRepeat:"no-repeat",height:h+"px",transform:["scale("+l+")","scale("+[s?-1:1,c?-1:1].join(",")+")","rotate("+f+"turn)","translate("+[o+"px",r+"px"].join(",")+")"].join(" "),position:"relative",width:m+"px"},d?{backgroundColor:d}:{},n?{transition:"all 0.5s"}:{})},g?a?{}:{directives:[{name:"Claw",arg:"pan",rawName:"v-claw:pan",value:function(t){y(t.x-t.previousX,t.y-t.previousY)}},{name:"Claw",arg:"panStart",rawName:"v-claw:panStart",value:p},{name:"Claw",arg:"panEnd",rawName:"v-claw:panEnd",value:v}]}:{}))}};var b={functional:!0,render:function(t,e){var i=e.parent,n=i.overriddenImageHeight,a=i.overriddenImageWidth;return t("div",{style:{bottom:0,left:0,overflow:"hidden",position:"absolute",right:0,top:0}},[t("div",{style:{bottom:"50%",position:"absolute",right:"50%",transform:"translate(50%,50%)"}},[t(z)]),t("div",{style:{bottom:"50%",boxShadow:"0 0 4000px 4000px rgba(0,0,0,0.5)",height:n+"px",pointerEvents:"none",position:"absolute",right:"50%",transform:"translate(50%,50%)",width:a+"px"}})])}};var H={functional:!0,render:function(t,e){var i=e.parent,n=i.cancelIcon,a=i.disabled,o=i.errorIcon,r=i.loadError,l=i.loadFromFile,s=i.loading,c=i.loadProgress,d=i.loadSuccess,u=i.successIcon,h=i.uploadIcon;return t("div",{style:{alignItems:"center",borderRadius:"4px",borderStyle:"dashed",borderWidth:"4px",bottom:0,cursor:a||s?void 0:"pointer",display:"flex",justifyContent:"center",left:0,position:"absolute",right:0,top:0},on:{click:function(t){t.preventDefault(),t.stopPropagation();var e=document.createElement("input");e.setAttribute("type","file"),e.addEventListener("change",(function(t){t.preventDefault();var e=t.target.files;e&&e.length&&l(e[0])})),e.click()}}},[t("VSlideYTransition",{props:{leaveAbsolute:!0}},[d?t("VIcon",{props:{color:"success",size:"64px"},key:1},u):r?t("VIcon",{props:{color:"error",size:"64px"},key:2},o):s?t("VProgressCircular",{props:{color:"primary",indeterminate:!c,rotate:-90,size:128,value:100*c,width:16}},[t("VBtn",{props:{icon:!0,large:!0,text:!0},on:{click:function(t){t.preventDefault(),t.stopPropagation()}}},[t("VIcon",n)])]):t("VIcon",{props:{size:"128px"},key:0},h)])])}};var V={functional:!0,render:function(t,e){var i=e.parent,n=i.reset,a=i.resetIcon;return t(g,{props:{icon:a},on:{click:n}})}};var w={functional:!0,render:function(t,e){var i=e.parent,n=i.rotateClockwise,a=i.rotateClockwiseIcon;return t(g,{props:{icon:a},on:{click:n}})}};var x={functional:!0,render:function(t,e){var i=e.parent,n=i.rotateCounterClockwise,a=i.rotateCounterClockwiseIcon;return t(g,{props:{icon:a},on:{click:n}})}};var C={functional:!0,render:function(t,e){var i=e.parent,n=i.disabled,a=i.overriddenMaxZoom,o=i.overriddenMinZoom,r=i.setZoom,l=i.zoom,s=i.zoomIn,c=i.zoomInIcon,d=i.zoomOut,u=i.zoomOutIcon,h=i.zoomSnap,m=i.lockDisplayedAnimations;return t("VSlider",{class:"ma-1",props:{appendIcon:c,disabled:n,hideDetails:!0,max:a,min:o,prependIcon:u,step:h,value:l},on:{"click:append":s,"click:prepend":d,end:i.unlockDisplayedAnimations,input:r,start:m}})}};var k={name:"VImageInput",directives:{Claw:o},inject:{theme:{default:{isDark:!1}}},props:{cancelIcon:{type:String,default:"$cancel"},clearable:r,clearIcon:{type:String,default:"$clear"},disabled:l,errorIcon:{type:String,default:"$error"},flipHorizontallyIcon:{type:String,default:"mdi-flip-horizontal"},flippable:s,flipVerticallyIcon:{type:String,default:"mdi-flip-vertical"},fullHeight:c,fullWidth:d,imageBackgroundColor:String,imageHeight:{type:Number,default:256},imageMaxHeight:{type:Number,default:512},imageMaxWidth:{type:Number,default:512},imageMinHeight:{type:Number,default:128},imageMinWidth:{type:Number,default:128},imageWidth:{type:Number,default:256},maxZoom:{type:Number,default:1},minZoom:{type:String,default:"cover"},resetable:u,resetIcon:{type:String,default:"mdi-restore"},resizable:h,rotatable:m,rotateClockwiseIcon:{type:String,default:"mdi-rotate-right"},rotateCounterClockwiseIcon:{type:String,default:"mdi-rotate-left"},successIcon:{type:String,default:"$success"},translatable:p,uploadIcon:{type:String,default:"mdi-upload"},value:String,zoomable:f,zoomInIcon:{type:String,default:"mdi-magnify-plus-outline"},zoomOutIcon:{type:String,default:"mdi-magnify-minus-outline"}},data:function(){return{animated:!0,cancellation:a,dirtyImageHeight:this.imageHeight,dirtyImageWidth:this.imageWidth,dirtyTranslationHorizontally:0,dirtyTranslationVertically:0,dirtyZoom:0,flippedHorizontally:!1,flippedVertically:!1,internalImage:null,loadError:!1,loading:!1,loadProgress:0,loadSuccess:!1,rotationInTurns:0,showImageSize:!1}},computed:{dark:function(){return this.theme.isDark},displayedTranslationHorizontally:function(){return this.translationHorizontally},displayedTranslationVertically:function(){return this.translationVertically},displayedZoom:function(){return this.zoom},internalImageDataURL:function(){var t=this.internalImage;return t?t.src:null},internalImageHeight:function(){var t=this.internalImage;return t?t.naturalHeight:0},internalImageWidth:function(){var t=this.internalImage;return t?t.naturalWidth:0},maxTranslationHorizontally:function(){return 1/0},maxTranslationVertically:function(){return 1/0},minTranslationHorizontally:function(){return-1/0},minTranslationVertically:function(){return-1/0},overriddenImageHeight:e,overriddenImageSize:function(){return[this.overriddenImageWidth,this.overriddenImageHeight]},overriddenImageWidth:i,overriddenMaxZoom:function(){return Math.max(this.maxZoom,this.overriddenMinZoom)},overriddenMinZoom:function(){var t=this.imageWidth/function(t,e,i){return Math.floor(t*Math.abs(Math.cos(i))+e*Math.abs(Math.sin(i)))}(this.internalImageWidth,this.internalImageHeight,this.rotationInRadians),e=this.imageHeight/function(t,e,i){return Math.floor(t*Math.abs(Math.sin(i))+e*Math.abs(Math.cos(i)))}(this.internalImageWidth,this.internalImageHeight,this.rotationInRadians);switch(this.minZoom){case"cover":return Math.max(t,e);case"contain":return Math.min(t,e)}return 0},returnImageDataURL:function(){var t=this,e=this,i=e.flippedHorizontally,n=e.flippedVertically,a=e.imageBackgroundColor,o=e.imageFormat,r=e.imageQuality,l=e.internalImage,s=e.overriddenImageHeight,c=e.overriddenImageWidth,d=e.rotationInRadians,u=e.translationHorizontally,h=e.translationVertically,m=e.zoom;return function(){if(l){var e=setTimeout((function(){var e=document.createElement("canvas");e.width=c,e.height=s;var p=e.getContext("2d");a&&(p.fillStyle=a,p.fillRect(0,0,c,s)),p.translate(c/2,s/2),p.translate(u,h),p.rotate(d),p.scale(i?-1:1,n?-1:1),p.scale(m,m),p.drawImage(l,0,0);var f=e.toDataURL("image/"+o,r);t.resetCancellation(),t.$emit("input",f)}),1e3);t.cancelWith((function(){clearTimeout(e)}))}else t.cancel(),t.$emit("input",null)}},rotationInRadians:function(){return this.rotationInTurns*n},showImageSizeTemporary:function(){var t,e=this;return function(){e.showImageSize=!0,clearTimeout(t),t=setTimeout((function(){e.showImageSize=!1}),2e3)}},translationHorizontally:{get:function(){return t(this.dirtyTranslationHorizontally,this.minTranslationHorizontally,this.maxTranslationHorizontally)},set:function(t){this.dirtyTranslationHorizontally=t}},translationVertically:{get:function(){return t(this.dirtyTranslationVertically,this.minTranslationVertically,this.maxTranslationVertically)},set:function(t){this.dirtyTranslationVertically=t}},zoom:{get:function(){return t(this.dirtyZoom,this.overriddenMinZoom,this.overriddenMaxZoom)},set:function(t){this.dirtyZoom=t}},zoomDelta:function(){return(this.overriddenMaxZoom-this.overriddenMinZoom)/10},zoomSnap:function(){return(this.overriddenMaxZoom-this.overriddenMinZoom)/1e3}},watch:{imageHeight:function(t){this.overridenImageHeight=t},imageWidth:function(t){this.overridenImageWidth=t},overriddenImageHeight:function(t){this.$emit("update:imageHeight",t)},overriddenImageSize:function(){this.showImageSizeTemporary()},overriddenImageWidth:function(t){this.$emit("update:imageWidth",t)},returnImageDataURL:function(t){},value:function(t){t?this.loadFromDataURL(t):this.clear()}},beforeDestroy:function(){this.cancel()},methods:{cancel:function(){this.triggerCancellation(),this.resetCancellation()},cancelWith:function(t){this.triggerCancellation(),this.setCancellation(t)},clear:function(){this.cancel(),this.internalImage=null,this.reset()},flipHorizontally:function(){this.flippedHorizontally=!this.flippedHorizontally},flipVertically:function(){this.flippedVertically=!this.flippedVertically},loadFromDataURL:function(t){var e=this,i=!1;this.cancelWith((function(){i=!0}));var n=new Image;n.addEventListener("load",(function(){i||(e.internalImage=n,e.reset(),e.resetCancellation())})),n.addEventListener("error",(function(){i||(e.internalImage=null,e.reset(),e.resetCancellation())})),n.src=t},loadFromFile:function(t){var e=this,i=!1,n=a;this.cancelWith((function(){i=!0,n(),e.loading=!1})),this.loadSuccess=!1,this.loadError=!1,this.loading=!0,this.loadProgress=0;var o=function(){i||(e.loadError=!0,e.loading=!1,e.resetCancellation())},r=setTimeout((function(){var r=new FileReader;r.addEventListener("progress",(function(t){i||t.lengthComputable&&(e.loadProgress=t.loaded/t.total)})),r.addEventListener("load",(function(){if(!i){var t=new Image;t.addEventListener("load",(function(){if(!i){e.loadSuccess=!0,e.loading=!1;var a=setTimeout((function(){e.internalImage=t,e.reset(),e.resetCancellation()}),1e3);n=function(){clearTimeout(a)}}})),t.addEventListener("error",o),n=a,t.src=r.result}})),r.addEventListener("error",o),n=function(){r.abort()},r.readAsDataURL(t)}),1e3);n=function(){clearTimeout(r)}},lockDisplayedAnimations:function(){this.animated=!1},reset:function(){this.dirtyImageWidth=this.imageWidth,this.dirtyImageHeight=this.imageHeight,this.dirtyTranslationHorizontally=0,this.dirtyTranslationVertically=0,this.rotationInTurns=0,this.flippedHorizontally=!1,this.flippedVertically=!1,this.dirtyZoom=0},resetCancellation:function(){this.setCancellation(a)},rotate:function(t){this.flippedHorizontally!==this.flippedVertically&&(t*=-1),this.rotationInTurns+=t},rotateClockwise:function(){this.rotate(1/4)},rotateCounterClockwise:function(){this.rotate(-1/4)},setCancellation:function(t){this.cancellation=t},setZoom:function(t){this.zoom=t},translate:function(t,e){this.translateHorizontally(t),this.translateVertically(e)},translateHorizontally:function(t){this.flippedHorizontally&&(t*=-1),t/=this.zoom,this.translationHorizontally+=t*Math.cos(this.rotationInRadians),this.translationVertically-=t*Math.sin(this.rotationInRadians)},translateVertically:function(t){this.flippedVertically&&(t*=-1),t/=this.zoom,this.translationHorizontally+=t*Math.sin(this.rotationInRadians),this.translationVertically+=t*Math.cos(this.rotationInRadians)},triggerCancellation:function(){this.cancellation()},unlockDisplayedAnimations:function(){this.animated=!0},zoomIn:function(){this.zoom+=this.zoomDelta},zoomOut:function(){this.zoom-=this.zoomDelta}},render:function(t){var e=this,i=e.clearable,n=e.flippable,a=e.fullHeight,o=e.fullWidth,r=e.internalImage,l=e.overriddenImageHeight,s=e.overriddenImageWidth,c=e.resetable,d=e.rotatable,u=e.zoomable;return t("div",{style:Object.assign({},{display:["-ms-inline-grid","inline-grid"],gridColumns:"1fr auto",gridRows:"1fr auto",gridTemplateColumns:"1fr auto",gridTemplateRows:"1fr auto"},o?{width:"100%"}:{},a?{height:"100%"}:{})},[t("div",{style:{gridColumn:1,gridRow:1,position:"relative"}},[t("div",{style:{height:l+"px",margin:"50px",width:s+"px"}}),t("VFadeTransition",{props:{leaveAbsolute:!0}},[r?t(b,{key:0}):t(H,{key:1})])]),t("div",{style:Object.assign({},{display:"flex",flexDirection:"column",gridColumn:2,gridRow:1,justifyContent:"center",transition:"opacity 0.3s cubic-bezier(0.25,0.8,0.5,1)"},r?{}:{opacity:0,pointerEvents:"none"})},(i?[t(y),t("VSpacer")]:[]).concat(d?[t(w),t(x)]:[],n?[t(v),t(I)]:[],c?[t("VSpacer"),t(V)]:[])),t("div",{style:Object.assign({},{gridColumn:1,gridRow:2,transition:"opacity 0.3s cubic-bezier(0.25,0.8,0.5,1)"},r?{}:{opacity:0,pointerEvents:"none"})},u?[t(C)]:[])])}},T=globalThis.window;if(T){var M=T.Vue;M&&M.component(k.name,k)}return k}));
